{"version":3,"sources":["scripts/gdq/vod-contentscript.js"],"names":["retrieveGameTitleList","$","next","text","console","log","each","gameArray","push","this","runnerArray","loadHighlightStorage","localStorage","getItem","setItem","JSON","stringify","storageObj","parse","chrome","storage","sync","set","scheduleHighlights","addHighlights","after","index","html","that","change","is","parent","css","gameTitle","getGameTitleString","data","prop","addBidWars","before","addMarioMakerLink","addRunnerLinks","getJSON","extension","getURL","done","resp","runnerJSON","runnerString","element","runners","split","runnerObjects","runner","generateFormattedRunnerString","location","runners_keys","_","keys","runner_string","length","last_runner","pop","second_runner","runner_key","generateRunnerElement","runnerObject","addVodLinks","eq","titles","title","templateString","generateVodString","filter","twitchString","youtubeString","includes","gameTitleString","document","ready"],"mappings":"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","file":"vod-contentscript.js","sourcesContent":["'use strict';\n\nvar gameArray = [];\nvar runnerArray = [];\nvar storageObj = null;\n$(document).ready(function () {\n\tretrieveGameTitleList();\n\tloadHighlightStorage();\n\taddHighlights();\n\taddRunnerLinks();\n\taddVodLinks();\n\taddBidWars();\n\t// addMarioMakerLink();\n});\n\nfunction retrieveGameTitleList() {\n\t$('tr:not(.day-split):not(.second-row) td:nth-child(2):contains(\"Mystery Game Tournament\")').next().text(\"Tech Crew\");\n\tconsole.log($('tr:not(.day-split):not(.second-row) td:nth-child(2):contains(\"Mystery Game Tournament\")').next().text());\n\n\t$('tr:not(.day-split):not(.second-row) td:nth-child(2)').each(function () {\n\t\tgameArray.push($(this).text());\n\t});\n\n\t$('tr:not(.day-split):not(.second-row) td:nth-child(3)').each(function () {\n\t\trunnerArray.push($(this).text());\n\t});\n}\n\nfunction loadHighlightStorage() {\n\tif (localStorage.getItem('scheduleHighlights') == null) {\n\t\tlocalStorage.setItem('scheduleHighlights', JSON.stringify({}));\n\t\tstorageObj = JSON.parse(localStorage.getItem('scheduleHighlights'));\n\t} else {\n\t\tstorageObj = JSON.parse(localStorage.getItem('scheduleHighlights'));\n\t\tchrome.storage.sync.set({ 'scheduleHighlights': storageObj }, function () {\n\t\t\tconsole.log('Schedule highlights saved to sync storage');\n\t\t});\n\t}\n}\n\nfunction addHighlights() {\n\t$('.text-gdq-black.well').after('<h4 class=\"text-gdq-black well\" id=\"star-highlight-notice\">Clicking the <i class=\"fa fa-star-o\"></i> beside the run will highlight it!<br >Use this to keep track of runs you want to watch.</h4>');\n\n\t$('tr:not(.day-split):not(.second-row) td:nth-child(1)').each(function (index) {\n\t\t$(this).html('<input type=\"checkbox\" class=\"highlight-run\" name=\"checkbox\" id=\"theater-mode' + index + '\"> <label for=\"theater-mode' + index + '\">' + $(this).text() + '</label>');\n\t\tvar that = $(this);\n\t\t$('#theater-mode' + index).change(function () {\n\t\t\tif ($(this).is(\":checked\")) {\n\t\t\t\tthat.parent().css('background-color', '#F0E68C');\n\t\t\t\tthat.parent().next('.second-row').css('background-color', '#F0E68C');\n\n\t\t\t\tvar gameTitle = getGameTitleString(that.next('td').text());\n\n\t\t\t\tstorageObj[gameTitle] = true;\n\n\t\t\t\tchrome.storage.sync.set({ 'scheduleHighlights': storageObj }, function (data) {\n\t\t\t\t\tconsole.log(\"Schedule highlights updated and saved to sync storage\");\n\t\t\t\t});\n\t\t\t\tlocalStorage.setItem('scheduleHighlights', JSON.stringify(storageObj));\n\t\t\t\tconsole.log('Starred and highlighted ' + gameTitle + ' on the schedule');\n\t\t\t} else {\n\t\t\t\tthat.parent().css('background-color', '#FFFFFF');\n\t\t\t\tthat.parent().next('.second-row').css('background-color', '#FFFFFF');\n\n\t\t\t\tvar gameTitle = getGameTitleString(that.next('td').text());\n\n\t\t\t\tstorageObj[gameTitle] = false;\n\n\t\t\t\tlocalStorage.setItem('scheduleHighlights', JSON.stringify(storageObj));\n\t\t\t\tchrome.storage.sync.set({ 'scheduleHighlights': storageObj }, function () {\n\t\t\t\t\tconsole.log(\"Schedule highlights updated\");\n\t\t\t\t});\n\t\t\t\tconsole.log('Removed the star and highlight for ' + gameTitle + ' on the schedule');\n\t\t\t}\n\t\t});\n\n\t\tif (storageObj[that.next('td').text()] == true) {\n\t\t\t$('#theater-mode' + index).prop(\"checked\", true).change();\n\t\t}\n\t});\n}\n\nfunction addBidWars() {\n\tconsole.log(\"Starting to add bid war indications\");\n\t$('#star-highlight-notice').before('<h4 class=\"text-gdq-black well\"><a href=\"https://gamesdonequick.com/tracker/bids/agdq2017\">Donation Incentives Bid War Tracker</a></h4>');\n}\n\nfunction addMarioMakerLink() {\n\tconsole.log(\"Adding Super Mario Maker Link\");\n\t$('#star-highlight-notice').before('<h4 class=\"text-gdq-black well\" id=\"gdq-mario-maker-levels\"><a href=\"https://makersofmario.com/worlds/view/547\">SGDQ Super Mario Maker Levels!</a></h4>');\n}\n\nfunction addRunnerLinks() {\n\tconsole.log(\"Adding Runners\");\n\n\t$.getJSON(chrome.extension.getURL('/json/agdq2017_runners.json')).done(function (resp) {\n\t\tconsole.log(resp);\n\t\tvar runnerJSON = resp;\n\n\t\t$.each(runnerArray, function (index, runnerString) {\n\t\t\t$('tr:not(.day-split):not(.second-row) td:nth-child(3):contains(' + runnerString + ')').each(function (index, element) {\n\t\t\t\tvar runners = runnerString.split(', ');\n\t\t\t\tvar runnerObjects = {};\n\n\t\t\t\tconsole.log(runnerString);\n\t\t\t\t$.each(runners, function (index, runner) {\n\t\t\t\t\trunnerObjects[runner] = runnerJSON[runner];\n\t\t\t\t});\n\t\t\t\t$(this).html(generateFormattedRunnerString(runnerObjects, 'table'));\n\t\t\t});\n\t\t});\n\t});\n}\n\nfunction generateFormattedRunnerString(runners, location) {\n\tvar runners_keys = _.keys(runners);\n\tvar runner_string = \"by \";\n\tif (location == 'table') {\n\t\trunner_string = \"\";\n\t}\n\tif (runners_keys.length > 2) {\n\t\tvar last_runner = runners_keys.pop();\n\t\tvar second_runner = runners_keys.pop();\n\t\t$.each(runners_keys, function (index, runner_key) {\n\t\t\trunner_string += generateRunnerElement(runners, runner_key, location) + ', ';\n\t\t});\n\n\t\trunner_string += generateRunnerElement(runners, second_runner, location) + ' ';\n\t\trunner_string += 'and ';\n\t\trunner_string += generateRunnerElement(runners, last_runner, location);\n\t} else if (runners_keys.length == 2) {\n\t\tvar last_runner = runners_keys.pop();\n\t\tvar second_runner = runners_keys.pop();\n\n\t\trunner_string += generateRunnerElement(runners, second_runner, location);\n\t\trunner_string += ' and ';\n\t\trunner_string += generateRunnerElement(runners, last_runner, location);\n\t} else if (runners_keys.length == 1) {\n\t\tvar runner_key = runners_keys[0];\n\t\trunner_string += generateRunnerElement(runners, runners_keys[0], location);\n\t} else {\n\t\tconsole.log(\"Error no runners.\");\n\t\trunner_string = \"\";\n\t}\n\treturn runner_string;\n}\n\nfunction generateRunnerElement(runnerObject, runner_key, location) {\n\tif (location == 'table') {\n\t\tif (runnerObject[runner_key][\"logo\"] == null) {\n\t\t\treturn '<a href=\"' + runnerObject[runner_key][\"link\"] + '\" onclick=\"window.open(this.href); return false;\">' + runner_key + '</a>';\n\t\t} else {\n\t\t\treturn '<a href=\"' + runnerObject[runner_key][\"link\"] + '\" onclick=\"window.open(this.href); return false;\">' + runner_key + '</a>';\n\t\t}\n\t} else {\n\t\tif (runnerObject[runner_key][\"logo\"] == null) {\n\t\t\treturn '<a href=\"' + runnerObject[runner_key][\"link\"] + '\" onclick=\"window.open(this.href); return false;\">' + runner_key + '</a>';\n\t\t} else {\n\t\t\treturn '<a href=\"' + runnerObject[runner_key][\"link\"] + '\" onclick=\"window.open(this.href); return false;\"><img class=\"runner-logo\" src=\"' + runnerObject[runner_key][\"logo\"] + '\" />' + runner_key + '</a>';\n\t\t}\n\t}\n}\n\nfunction addVodLinks() {\n\tconsole.log(\"Starting to add links\");\n\t$('td:contains(' + \"Super Mario World\" + '):first').text('Super Mario World Race');\n\t$('td:contains(' + \"The Legend of Zelda: Ocarina of Time\" + ')').eq(1).text('The Legend of Zelda: Ocarina of Time Glitch Exhibition');\n\n\t$.getJSON(\"https://gist.githubusercontent.com/theoriginalcamper/097c11a5d7a6cf7b2b45649eaff706f0/raw/agdq2017-vod.json\").done(function (data) {\n\t\tconsole.log(data);\n\t\tvar titles = _.keys(data);\n\t\tconsole.log(titles);\n\n\t\t$.each(titles, function (index, title) {\n\t\t\t// console.log(title);\n\t\t\tvar templateString = generateVodString(title, data);\n\t\t\t$('tr:not(.day-split):not(.second-row) td:nth-child(2)').filter(function (index) {\n\t\t\t\treturn $(this).text() == title;\n\t\t\t}).html(templateString);\n\t\t});\n\n\t\tconsole.log(\"Done\");\n\t});\n}\n\nfunction generateVodString(title, data) {\n\tvar twitchString = 'https://www.twitch.tv/gamesdonequick/v/' + data[title][\"video-link\"] + '?t=' + data[title][\"time\"];\n\n\tif (typeof data[title][\"youtube\"] != 'undefined') {\n\t\tvar youtubeString = data[title][\"youtube\"];\n\t\treturn title + ' - <i class=\"fa fa-check\"></i> COMPLETED <a href=\"' + twitchString + '\" class=\"vod-link\"><i class=\"fa fa-twitch\"></i></a> <a href=\"' + youtubeString + '\" class=\"vod-link\"><i class=\"fa fa-youtube\"></i></a>';\n\t} else {\n\t\treturn '<a href=\"' + twitchString + '\" class=\"vod-link\">' + title + ' - <i class=\"fa fa-check\"></i> COMPLETED <i class=\"fa fa-twitch\"></i> Twitch Only</a>';\n\t}\n}\n\nfunction getGameTitleString(title) {\n\tif (title.includes(\"COMPLETED\")) {\n\t\tvar gameTitleString = title.split(\" - \")[0];\n\t} else {\n\t\tvar gameTitleString = title;\n\t}\n\n\treturn gameTitleString;\n}"]}